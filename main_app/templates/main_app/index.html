{% extends 'main_app/base.html' %}

{% block content %}


{% if messages %}
<ul class="messages">
  {% for message in messages %}
  <div class="alert alert-success" role="alert">{{ message }}</div>
  {% endfor %}
</ul>
{% endif %}

<div class="accordion" id="accordionExample">
  <div class="accordion-item">
    <h2 class="accordion-header" id="headingOne">
      <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne"
        aria-expanded="true" aria-controls="collapseOne">
        Поиск
      </button>
    </h2>
    <div id="collapseOne" class="accordion-collapse collapse" aria-labelledby="headingOne"
      data-bs-parent="#accordionExample">
      <div class="accordion-body">
        <form action="" method='get'>
          <div class="container">
            <div class="row">

              <div class="col-sm align-self-center">
                <!--  -->
                <!-- Поиск по цене -->

                <div class="input-group mb-3">
                  <input name="from_price" type="text" aria-label="First name" placeholder="Цена от"
                    class="form-control">
                  <span class="input-group-text"></span>
                  <input name="to_price" type="text" aria-label="Last name" placeholder="Цена до" class="form-control">
                </div>

                <!-- Поиск по кол-ву -->
                <div class="input-group mb-3">
                  <!-- <span class="input-group-text">От</span> -->
                  <input name="from_count" type="text" aria-label="First name" placeholder="Кол-во от"
                    class="form-control">
                  <span class="input-group-text"></span>
                  <input name="to_count" type="text" aria-label="Last name" placeholder="Кол-во до"
                    class="form-control">
                </div>

              </div>

              <div class="col-sm">
                <!-- Поиск по категории -->
                <div class="form-floating mb-3">
                  <select class="form-select" name='category' id="floatingSelect"
                    aria-label="Floating label select example">
                    <option label=""></option>
                    {% for c in category %}
                    <option value="{{c.pk}}">{{c.name}}</option>
                    {% endfor %}
                  </select>
                  <label for="floatingSelect">Поиск по категории</label>
                </div>
                <!--  -->
                <!-- Поиск по подкатегории -->
                <div class="form-floating mb-3">
                  <select name="subcategory" class="form-select" id="floatingSelect"
                    aria-label="Floating label select example">
                    <option></option>
                    {% for c in category %}
                    <optgroup label="{{c}}">
                      {% for sc in c.subcategory_set.all %}
                      {% if sc == product.subcategory %}
                      <option value="{{sc.pk}}">{{sc.name}}</option>
                      {% else %}
                      <option value="{{sc.pk}}">{{sc.name}}</option>
                      {% endif %}
                      {% endfor %}
                    </optgroup>
                    {% endfor %}
                  </select>
                  <label for="floatingSelect">Поиск по подкатегории</label>
                </div>
              </div>
              <div class="col-sm">
                <!-- Поиск по имени -->
                <div class="form-floating mb-3">
                  <input class="form-control" name="title" type="text" placeholder="Поиск по имени"
                    aria-label="default input example">
                  <label for="floatingInput">Поиск по имени</label>
                </div>
                <!--  -->

                <div class="form-floating mb-3">
                  <select name='order_by' class="form-select" id="floatingSelect"
                    aria-label="Floating label select example">
                    <option selected></option>
                    <option value="count">Количеству (по убыванию)</option>
                    <option value="-count">Количеству (по возрастанию)</option>
                    <option value="price">Цене (по убыванию)</option>
                    <option value="-price">Цене (по возрастанию)</option>

                  </select>
                  <label for="floatingSelect">Сортировать по</label>
                </div>

              </div>
              <div class="col-sm align-self-center">
                <!-- Кнопка -->
                <div class='text-center'>
                <input type="submit" class='btn btn-success btn-lg' name='search' value="Поиск">
              </div>
                <!--  -->
              </div>
            </div>
          </div>

        </form>
      </div>
    </div>
  </div>
  <table class="table">
    <thead>
      <tr>
        <th scope="col">#</th>
        <th scope="col">Название</th>
        <th scope="col">Цена</th>
        <th scope="col">Кат</th>
        <th scope="col">Подкат</th>
        <th scope="col">Остаток</th>
        <th scope="col">#</th>
      </tr>
    </thead>
    <tbody>
      {% for p in product %}
      <tr>
        <th scope="row">{{p.pk}}</th>
        <td>{{p.title}}</td>
        <td>{{p.price}}</td>
        <td>{{p.subcategory.category}}</td>
        <td>{{p.subcategory}}</td>
        <td>{{p.count}}</td>
        <td><a class="btn btn-primary btn-warning" href="{% url 'productdetail' pk=p.pk %}" role="button">#</a>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>


  {% endblock %}