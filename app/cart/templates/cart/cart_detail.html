{% extends 'base.html' %}
{% block title %}Shopping cart{% endblock %}
{% block content %}
<div class="card shadow-custom border-0 col-lg-10 mx-auto mb-3">
    <h3 class="py-2 font-weight-bold text-grey text-center">
        Ваш заказ:
    </h3>
    <div class="row justify-content-center py-2 text-center header-desc">
        <div class="col-lg-2 align-self-center">
            Товар
        </div>
        <div class="col-lg-2 align-self-center">
            Название
        </div>
        <div class="col-lg-2 align-self-center">
            В наличии
        </div>
        <div class="col-lg-1 align-self-center">
            Цена
        </div>
        <div class="col-lg-2 align-self-center">
            Количество
        </div>
        <div class="col-lg-3 align-self-center">
            Общая цена
        </div>
    </div>
    <hr class="mt-0">
    {% for item in cart %}
    {% with product=item.product %}
    <div class="row justify-content-center cart">
        <div class="cart-item col-4 col-lg-2">
            <a href="{% url 'online_shop:product_detail' product.slug %}">
                <img src="{{ product.photo.url }}" alt="" class="img-fluid rounded-0">
            </a>
        </div>
        <div class="cart-item product-name col-12
col-lg-2 align-self-center text-center">
            {{ product.title }}
        </div>
        <div class="cart-item col-12 col-lg-2 align-self-center">
            {% if product.count > 0 %}
            <div class="text-green mb-0 text-center">
                <i class="fas fa-check"></i>
            </div>
            {% else %}
            <div class="text-danger mb-0 text-center">
                <i class="fas fa-times"></i>
            </div>
            {% endif %}
        </div>
        <div class="cart-item col-12 col-sm-3 col-lg-1 align-self-center text-center">
            <span>{{ product.price }} руб.</span>
        </div>
        <div class="cart-item col-6 col-sm-5 col-lg-2 align-self-center">
            <form action="{% url 'cart:cart_add' product.id %}" method='post'>
                {% csrf_token %}
                <span class="input-group shopping-cart">
                    {{ item.update_quantity_form.quantity }}
                    <input type="hidden" name="overwrite_qty" value="True">
                    <div class="input-group-append">
                        <button type="submit" class="btn text-white" data-toggle="tooltip" data-placement="top"
                            title="Update">
                            <i class="fas fa-edit"></i>
                        </button>
                    </div>
                </span>
            </form>
        </div>
        <div class="cart-item col-12 col-sm-3 col-lg-2 align-self-center text-right">
            <span>{{ item.total_price }} руб.</span>
        </div>
        <div class="cart-item col-12 col-lg-1 text-right
align-self-center">
            <form action="{% url 'cart:cart_remove' product.id %}" method="post">
                {% csrf_token %}
                <button type="submit" class="btn" data-toggle="tooltip" data-placement="top" title="Remove">
                    <i class="fas fa-trash-alt"></i>
                </button>
            </form>
        </div>
    </div>
    {% endwith %}
    {% empty %}
    <div class="align-self-center">
        <span class="text-center font-weight-bold text-muted lead">
            Ваша корзина пуста.
        </span>
    </div>
    {% endfor %}
    <hr>
    <div class="total-price-cart">
        <h4 class="row justify-content-center">
            <div class="col-5 col-lg-9 text-right text-grey">
                Общая цена:
            </div>
            <div class="col-5 col-lg-2 text-right text-danger">
                {{ cart_total_price|floatformat:2 }} р.
            </div>
            <div class="col-2 col-lg-1">
            </div>
        </h4>
    </div>
</div>
<hr>
<div class="col-lg-10 mx-auto mb-5">
    <div class="row justify-content-end">
        {% if cart|length > 0 %}
        <div class="col-lg-6 px-0">
            <div class="btn-group d-flex">
                <a href="{% url 'online_shop:product_list' %}" class="btn btn-warning shadow-custom col">
                    Назад
                </a>
                <a href="{% url 'online_shop:order_create' %}" class="btn btn-danger shadow-custom col">
                    Оформить заказ
                </a>
            </div>
        </div>
        {% else %}
        <div class="col-lg-3 px-0">
            <div class="btn-group d-flex">
                <a href="{% url 'online_shop:product_list' %}" class="btn btn-warning shadow-custom col">
                    Back to shop
                </a>
            </div>
        </div>
        {% endif %}
    </div>
</div>
{% endblock content %}