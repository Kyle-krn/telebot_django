# Интернет-магазин на Django + Telegram-бот магазин с теми же товарами
---
Проект представляет из себя 2 интернет-магазина в вебе и телеграме использующие одну и ту же базу данных товаров, давайте об этом поподробнее:

Бот
-------------------------
1. Полный каталог товаров, с адаптивной клавиутарой пополнения корзины
![Alt Text](https://s10.gifyu.com/images/catalog1183ec0f60c2c40c.gif)
2. Управление корзиной и заказ товара через менеджера
![Alt Text](https://s10.gifyu.com/images/del_cart.gif)
3. Оплата через Qiwi и список заказов пользователя (В этом случае товар бронируется для покупки на 15 минут)
![Alt Text](https://s10.gifyu.com/images/qiwi_and_my_tovary.gif)
4. Поиск товаров по совпадению в названии
![Alt Text](https://s10.gifyu.com/images/search_tovar.gif)
5. В приватный канал сообщает о каждой покупке (Боте, сайте и оффлайн магазине)
![Alt Text](https://i.ibb.co/Kbn5hBh/hanel.png)
6. А так же проверяет индекс на валидность и самостоятельно расчитывает стоймость доставки почтой РФ и примерные сроки доставки, используя API Почты РФ и DADATA

Интернет-магазин
-------------------------
1. Каталог товаров, с возможностью выбрать определенную категорию или подкатегорию, а так же детальное представление товара и система отзывов и рейтинга товара
![Alt Text](https://s10.gifyu.com/images/catalog_and_review.gif)
2. Регистрация пользователей и заполнение профиля для заказов
![Alt Text](https://s10.gifyu.com/images/register_and_profile.gif)
3. Создание заказа, расчет доставки и валидация индекса, оплата через QIWI и генерация PDF счёта, доступного в профиле, а так же скинут на указанную в заказе почту после оплаты.
![Alt Text](https://s10.gifyu.com/images/1ceb0ebc1c6a47aa5.gif)
4. Так же доступно скинуть пароль через почту.
5. Вся почта отправляется через Celery, так что не тормозит ответ сервера

Кастомная админка
-------------------------
1. Просмотр товаров, категорий, подкатегорий, а так же их создание
![Alt Text](https://s10.gifyu.com/images/list_product_category_create_all.gif)
2. Поиск товара и подробное представление о товаре, его изменение, статистика продаж, таблица прихода, расхода, а так же добавление кол-ва товара или его отнимание
![Alt Text](https://s10.gifyu.com/images/search_tovar_and_detailview.gif)
3. Сменяймый киви кошелек для оплаты в боте (к сайту привязан только один кошелек, об этом ниже), общая статистика по магазину
![Alt Text](https://s10.gifyu.com/images/qiwi_statistc.gif)
4. Если пользователь оформил заказ через мендежера, он может изменить свою корзину через менедежра, так же менеджер может отменить заказ оплаченным после 
факта оплаты
![Alt Text](https://s10.gifyu.com/images/order_and_my_tovary.gif)

Изолированное приложение - seller_site
-------------------------
Приложение с теми же шаблонами как в кастомной админке, и с похожей логикой, отличается тем что использует отдельные модели товаров, а чеки создают продавцы, под своими аккаунтами,
используется для учета товара в оффлайн магазине, при желании вы можете полностью вырезать приложение, для этого в файле
```/vape_shop/settings.py``` в списке ```INSTALLED_APPS``` удалите строчку ```'online_shop.apps.OnlineShopConfig'```
и удалите ссылки на url в шаблонах других приложений.
1. Администратор может регестрировать продавцов (Пользователи в группе 'sellers'), после этого продавец может залогиниться и оформить чек в оффлайн магазине, 
продавец может только оформить приемку товара, и оформить новый чек.
![Alt Text](https://s10.gifyu.com/images/main_seller.gif)
2. Продавцу так же доступна страница с его заказами за эти сутки, а так же показывается отчисления ему за заказы
![Alt Text](https://s10.gifyu.com/images/order_and_seller_pay.gif)



# Запуск локально
---
В приложении есть библиотеки ```Celery``` и ```WeastyPrint```, они требуют Linux-систему, если вы разрабатываете на Windows, попробуйте установить Ubuntu как WSL приложение и вести разработку от туда. Если же все таки очень надо запустить на Windows, то закоментируйте ту часть кода где используется ```WeastyPrint``` и сервер запустится, но не будет работать генерация PDF счетов. Из за не работы ```Celery``` не будет работать: Вся почта и Beat задачи (Чекер бронирования заказов на истечение времени и проверка QIWI оплаты черех сайт). 
* Клонируйте репозиторий с github
* Для работы ```weastyprint``` понадобится ```libpangocairo```, установите ее командой ```sudo apt-get install libpangocairo-1.0-0```
* Создайте виртуальное окружение
* Установите зависимости `pip install -r requariements.txt`
* Если возникают сложности при установке пакетов в виртуальном окружении, попробуйте эти команды:
  ```pip install -U pip``` и ```pip install --upgrade setuptools```
* 10 Создайте папки ```media``` и ```logs``` в корне проекта
* Измените название файла `vape_shop/  settings.py.example`, убрав из него `.example`
  - ```TELEGRAM_TOKEN``` - Токен от телеграм бота
  - ```TELEGRAM_GROUP_ID``` - ID канала где бот должен быть администратором, что бы отправлять данные о заказах
  - ```DADATA_TOKEN``` - https://dadata.ru/api/
  - ```QIWI_PRIVATE_KEY``` - Приватный ключ от p2p QIWI, для оплаты по ссылкам на сайте https://p2p.qiwi.com/
 
   Рассылка email из gmail, нужно разрешить аккаунту доступ к стороним приложениям, ищите в настройках google ```Ненадежные приложения, у которых есть доступ к аккаунту```
     -  ```EMAIL_PASSWORD``` = пароль от почты
     -  ```EMAIL_BACKEND``` = "django.core.mail.backends.smtp.EmailBackend"
     -  ```EMAIL_HOST``` = "smtp.gmail.com"
     -  ```EMAIL_USE_TLS``` = True
     -  ```EMAIL_PORT``` = 587
     -  ```EMAIL_HOST_USER``` = почта
     -  ```EMAIL_HOST_PASSWORD``` = пароль от почты
* Установите RabbitMQ для Celery командой: ```sudo apt-get install rabbitmq-server```
* Убедитесь что RabbitMQ работает, выполнив команду: ```sudo rabbitmq-server```
* Локальный запусе использует SQLLite, так что просто примините миграции командой: ```python3 manage.py migrate```
* Можете запустить бота командой: ```python3 manage.py bot```
* Запустить сайт локально: ```python3 manage.py runserver```
* Запустите celery командой: ```celery -A vape_shop worker -l info```

# Запуск на сервере
---
Смотрите полное руководство по деплою проекта на сервер в файле ```DEPLOY_README.md```
 
# Запуск через Docker
---
В Докере настроен: Django + Postgres + Celery + RabbitMQ + Nginx/gunicorn

Запустите контейнер командой: ```docker-compose up --build -d```

Проверьте приложение командой: ```docker-compose logs -f```


# Примеры
---
https://cloudrinku.me - Сайт

https://t.me/vape_shop_django_bot - Бот






